<%- include("../partials/header"); %>

  <div class="govuk-width-container app-width-container">
      <main class="govuk-main-wrapper" id="main-content" role="main">

        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-xl"><%= locals.group?.name %></h1>

            <h2 class="govuk-heading-l"><%= t('admin.group.view.details.heading') %></h2>
            <dl class="govuk-summary-list">
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key"><%= t('admin.group.view.details.organisation.heading') %></dt>
                <dd class="govuk-summary-list__value"><%= locals.group?.organisation || t('admin.group.view.details.organisation.not_set') %></dd>
              </div>
              <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key"><%= t('admin.group.view.details.email.heading') %></dt>
                <dd class="govuk-summary-list__value"><%= locals.group?.email || t('admin.group.view.details.email.not_set') %></dd>
              </div>
            </dl>

            <a href="<%= buildUrl(`/admin/group/${locals.group.id}/name`, i18n.language) %>" class="govuk-link"><%= t('admin.group.view.buttons.edit') %></a>
          </div>
        </div>

        <div class="govuk-grid-row govuk-!-margin-top-6">
          <div class="govuk-grid-column-two-thirds">
            <h2 class="govuk-heading-l"><%= t('admin.group.view.users.heading') %></h2>
            <% if (!locals.group?.users || locals.group.users.length === 0) { %>
              <p><%= t('admin.group.view.users.none') %></p>
            <% } else { %>
              <%- include("../partials/table", {
                columns: [
                  {
                    key: 'name',
                    label: t('admin.group.view.users.table.name'),
                    format: (value, row) => {
                      const url = buildUrl(`/admin/user/${row.id}`, i18n.language);
                      return `<a href="${url}" class="govuk-link">${row.full_name || row.email}</a>`
                    }
                  },
                  {
                    key: 'roles',
                    label: t('admin.group.view.users.table.roles'),
                    format: (value) => value?.map(r => t(`user_roles.${r}`)).join(', ')
                  },
                  {
                    key: 'status',
                    label: t('admin.group.view.users.table.status'),
                    format: (value) => `<strong class="govuk-tag govuk-tag--${statusToColour(value)}">${t(`admin.user.badge.status.${value}`)}</strong>`
                  }
                ],
                rows: locals.group.users.map(userWithRoles => {
                  return {
                    ...userWithRoles.user,
                    roles: userWithRoles.roles
                  }
                })
              }); %>
            <% } %>
          </div>
        </div>

        <div class="govuk-grid-row">
          <div class="govuk-grid-column-two-thirds">
            <h2 class="govuk-heading-l"><%= t('admin.group.view.datasets.heading') %></h2>
            <% if (!locals.group?.datasets || locals.group.datasets.length === 0) { %>
              <p><%= t('admin.group.view.datasets.none') %></p>
            <% } else { %>
              <p><%= t('admin.group.view.datasets.some', { count: locals.datsetCount }) %></p>
            <% } %>
          </div>
        </div>

      </main>
  </div>

<%- include("../partials/footer"); %>
