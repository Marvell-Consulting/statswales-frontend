import{w as f}from"./with-props-daUcymKh.js";import{j as e}from"./context-Zvpbq3dQ.js";import{T as b}from"./Table-BHT1KmCI.js";import{c as M,t as j,m as w,a as p,d as m}from"./date-format-trgs2e0w.js";import{u as y,T as t}from"./T-CQIXqhPq.js";import{D as T}from"./DatasetStatus-BlR5j9Z6.js";import{r as C,j as S}from"./chunk-DQRVZFIR-CI4QRDf9.js";import{P as U}from"./Pagination-CTQ2at6l.js";import{R as v}from"./RadioGroup-DktJgkR6.js";import{S as k}from"./Select-DL5FhX3p.js";import{T as D}from"./Tabs-BPtvNYv5.js";import{l as P}from"./locale-url-yD_AyXRN.js";import"./clsx-B-dksMZM.js";import"./status-to-colour-CUWEJy7V.js";import"./LocaleLink-CIhOCkNj.js";import"./ErrorProvider-Cxuz4RMS.js";function R(a,s){const i=()=>M(s==null?void 0:s.in,NaN),r=Y(a);let l;if(r.date){const d=L(r.date,2);l=q(d.restDateString,d.year)}if(!l||isNaN(+l))return i();const u=+l;let o=0,c;if(r.time&&(o=H(r.time),isNaN(o)))return i();if(r.timezone){if(c=V(r.timezone),isNaN(c))return i()}else{const d=new Date(u+o),g=j(0,s==null?void 0:s.in);return g.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),g.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),g}return j(u+o+c,s==null?void 0:s.in)}const h={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},F=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,z=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,A=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Y(a){const s={},i=a.split(h.dateTimeDelimiter);let n;if(i.length>2)return s;if(/:/.test(i[0])?n=i[0]:(s.date=i[0],n=i[1],h.timeZoneDelimiter.test(s.date)&&(s.date=a.split(h.timeZoneDelimiter)[0],n=a.substr(s.date.length,a.length))),n){const r=h.timezone.exec(n);r?(s.time=n.replace(r[1],""),s.timezone=r[1]):s.time=n}return s}function L(a,s){const i=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+s)+"})|(\\d{2}|[+-]\\d{"+(2+s)+"})$)"),n=a.match(i);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,l=n[2]?parseInt(n[2]):null;return{year:l===null?r:l*100,restDateString:a.slice((n[1]||n[2]).length)}}function q(a,s){if(s===null)return new Date(NaN);const i=a.match(F);if(!i)return new Date(NaN);const n=!!i[4],r=_(i[1]),l=_(i[2])-1,u=_(i[3]),o=_(i[4]),c=_(i[5])-1;if(n)return E(s,o,c)?O(s,o,c):new Date(NaN);{const d=new Date(0);return!$(s,l,u)||!W(s,r)?new Date(NaN):(d.setUTCFullYear(s,l,Math.max(r,u)),d)}}function _(a){return a?parseInt(a):1}function H(a){const s=a.match(z);if(!s)return NaN;const i=x(s[1]),n=x(s[2]),r=x(s[3]);return B(i,n,r)?i*w+n*p+r*1e3:NaN}function x(a){return a&&parseFloat(a.replace(",","."))||0}function V(a){if(a==="Z")return 0;const s=a.match(A);if(!s)return 0;const i=s[1]==="+"?-1:1,n=parseInt(s[2]),r=s[3]&&parseInt(s[3])||0;return G(n,r)?i*(n*w+r*p):NaN}function O(a,s,i){const n=new Date(0);n.setUTCFullYear(a,0,4);const r=n.getUTCDay()||7,l=(s-1)*7+i+1-r;return n.setUTCDate(n.getUTCDate()+l),n}const Z=[31,null,31,30,31,30,31,31,30,31,30,31];function N(a){return a%400===0||a%4===0&&a%100!==0}function $(a,s,i){return s>=0&&s<=11&&i>=1&&i<=(Z[s]||(N(a)?29:28))}function W(a,s){return s>=1&&s<=(N(a)?366:365)}function E(a,s,i){return s>=1&&s<=53&&i>=0&&i<=6}function B(a,s,i){return a===24?s===0&&i===0:i>=0&&i<60&&s>=0&&s<60&&a>=0&&a<25}function G(a,s){return s>=0&&s<=59}function I(a){const{t:s}=y(),i=a.headers.map((n,r)=>({key:r,label:n.name,format:l=>n.source_type==="line_number"?e.jsx("span",{className:"linespan",children:l}):n.name===s("consumer_view.start_data")||n.name===s("consumer_view.end_data")?m(R(l.split("T")[0]),"do MMMM yyyy"):l,className:n.source_type==="line_number"?"line-number":"",cellClassName:n.source_type==="line_number"?"line-number":""}));return e.jsx(b,{isSticky:!0,columns:i,rows:a.data})}function J({about:a}){var s;return e.jsxs("div",{className:"dataset-about",children:[e.jsx("h2",{className:"govuk-heading-m",children:e.jsx(t,{children:"dataset_view.about.overview"})}),e.jsxs("dl",{className:"govuk-summary-list",children:[e.jsxs("div",{id:"summary",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.about.summary"})}),e.jsx("dd",{className:"govuk-summary-list__value",dangerouslySetInnerHTML:{__html:a.summary||e.jsx(t,{children:"dataset_view.not_entered"})}})]}),e.jsxs("div",{id:"data-collection",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.about.data_collection"})}),e.jsx("dd",{className:"govuk-summary-list__value",dangerouslySetInnerHTML:{__html:a.collection||e.jsx(t,{children:"dataset_view.not_entered"})}})]}),e.jsxs("div",{id:"data-quality",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.about.statistical_quality"})}),e.jsx("dd",{className:"govuk-summary-list__value",dangerouslySetInnerHTML:{__html:a.quality||e.jsx(t,{children:"dataset_view.not_entered"})}})]}),e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.about.related_reports"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:(((s=a.relatedLinks)==null?void 0:s.length)||0)>0?e.jsx("ul",{className:"govuk-list",children:a.relatedLinks.map((i,n)=>e.jsx("li",{children:e.jsx("a",{className:"govuk-link govuk-link--no-underline",href:i.url,target:"_blank",children:i.label})},n))}):e.jsx(t,{children:"dataset_view.not_entered"})})]})]})]})}function K({keyInfo:a}){return e.jsxs("div",{className:"dataset-key-information",children:[e.jsx("h2",{className:"govuk-heading-m",children:e.jsx(t,{children:"dataset_view.key_information.heading"})}),e.jsxs("dl",{className:"govuk-summary-list",children:[e.jsxs("div",{id:"last-updated",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.key_information.last_update"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:a.updatedAt?m(a.updatedAt,"d MMMM yyyy"):e.jsx(t,{children:"dataset_view.key_information.update_missing"})})]}),e.jsxs("div",{id:"next-updated",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.key_information.next_update"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:a.nextUpdateAt?m(a.nextUpdateAt,"MMMM yyyy"):a.nextUpdateAt===!1?e.jsx(t,{children:"dataset_view.key_information.not_updated"}):e.jsx(t,{children:"dataset_view.key_information.next_update_missing"})})]}),e.jsxs("div",{id:"designation",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.about.designation"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:a.designation?e.jsxs(t,{children:["dataset_view.about.designations.",a.designation]}):e.jsx(t,{children:"dataset_view.not_selected"})})]}),a.providers!==void 0&&a.providers.length>0?a.providers.map((s,i)=>e.jsxs(C.Fragment,{children:[e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:a.providers.length>1?e.jsx(t,{index:i+1,children:"dataset_view.key_information.data_providers"}):e.jsx(t,{children:"dataset_view.key_information.data_provider"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:s.provider_name})]}),e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:a.providers.length>1?e.jsx(t,{index:i+1,children:"dataset_view.key_information.data_sources"}):e.jsx(t,{children:"dataset_view.key_information.data_source"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:s.source_name?s.source_name:e.jsx(t,{children:"dataset_view.key_information.no_source"})})]})]},i)):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.key_information.data_provider"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:e.jsx(t,{children:"dataset_view.not_selected"})})]}),e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.key_information.data_source"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:e.jsx(t,{children:"dataset_view.not_selected"})})]})]}),e.jsxs("div",{id:"time-period",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.key_information.time_covered"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:a.timePeriod.start&&a.timePeriod.end?e.jsx(t,{start:m(a.timePeriod.start,"MMMM yyyy"),end:m(a.timePeriod.end,"MMMM yyyy"),raw:!0,children:"dataset_view.key_information.time_period"}):e.jsx(t,{children:"dataset_view.period_cover_missing"})})]})]})]})}function Q({notes:a}){var s,i;return!((s=a.publishedRevisions)!=null&&s.length)&&!a.roundingApplied?null:e.jsxs("div",{className:"dataset-notes",children:[e.jsx("h2",{className:"govuk-heading-m govuk-!-margin-top-6",children:e.jsx(t,{children:"dataset_view.notes.heading"})}),e.jsxs("dl",{className:"govuk-summary-list",children:[(((i=a.publishedRevisions)==null?void 0:i.length)||0)>1&&e.jsxs("div",{id:"revisions",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.notes.revisions"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:e.jsx("ul",{className:"govuk-list",children:a.publishedRevisions.map((n,r)=>e.jsx("li",{children:e.jsx("strong",{children:m(n.publish_at,"d MMMM yyyy")})},r))})})]}),a.roundingApplied&&e.jsxs("div",{id:"data-rounding",className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.notes.rounding"})}),e.jsx("dd",{className:"govuk-summary-list__value",dangerouslySetInnerHTML:{__html:a.roundingDescription}})]})]})]})}function X({published:a}){var s;return e.jsxs("div",{className:"dataset-published",children:[e.jsx("h2",{className:"govuk-heading-m govuk-!-margin-top-6",children:e.jsx(t,{children:"dataset_view.published.heading"})}),e.jsxs("dl",{className:"govuk-summary-list",children:[e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.published.org"})}),e.jsx("dd",{className:"govuk-summary-list__value",children:((s=a.organisation)==null?void 0:s.name)||e.jsx(t,{children:"dataset_view.not_entered"})})]}),e.jsxs("div",{className:"govuk-summary-list__row",children:[e.jsx("dt",{className:"govuk-summary-list__key",children:e.jsx(t,{children:"dataset_view.published.contact"})}),e.jsx("dd",{className:"govuk-summary-list__value"})]})]})]})}const ge=f(function({loaderData:s}){const[i]=S(),{i18n:n}=y(),r=e.jsx("div",{className:"govuk-width-container",children:e.jsxs("div",{className:"govuk-main-wrapper govuk-!-padding-top-0",children:[e.jsxs("div",{className:"govuk-grid-row govuk-!-margin-bottom-0",children:[e.jsx("div",{className:"govuk-grid-column-one-half",children:e.jsxs("form",{method:"get",children:[e.jsx(k,{name:"dataViewsChoice",label:e.jsx(t,{children:"consumer_view.data_view"}),labelClassName:"govuk-label--s",options:[{value:"",label:e.jsx(t,{children:"consumer_view.select_view"})},{value:"default",label:e.jsx(t,{children:"consumer_view.data_table"})}],value:i.get("dataViewsChoice"),inline:!0})," ",e.jsx("button",{type:"submit",className:"govuk-button button-black govuk-button-small","data-module":"govuk-button",children:e.jsx(t,{children:"consumer_view.apply_view"})})]})}),e.jsx("div",{className:"govuk-grid-column-one-half govuk-!-text-align-right",children:e.jsx(t,{start:s.page_info.start_record,end:s.page_info.end_record,total:s.page_info.total_records,children:"publish.preview.showing_rows"})})]}),e.jsx("hr",{className:"govuk-section-break govuk-section-break--m govuk-section-break--visible govuk-!-padding-top-0"}),e.jsxs("div",{className:"govuk-grid-row",children:[e.jsx("div",{className:"govuk-grid-column-one-quarter",children:e.jsxs("form",{method:"get",children:[e.jsx("h3",{children:e.jsx(t,{children:"consumer_view.filters"})}),e.jsx(k,{name:"page_size",label:e.jsx(t,{children:"pagination.page_size"}),value:String(s.page_size),options:[5,10,25,50,100,250,500].map(o=>({value:o,label:String(o)}))}),e.jsx("button",{name:"dataViewsChoice",value:"filter",type:"submit",className:"govuk-button button-black","data-module":"govuk-button",children:e.jsx(t,{children:"consumer_view.apply_filters"})})]})}),e.jsxs("div",{className:"govuk-grid-column-three-quarters",children:[e.jsx("div",{className:"govuk-!-padding-top-5 govuk-!-margin-bottom-2",children:e.jsx(I,{...s})}),e.jsx(U,{...s,hideLineCount:!0})]})]})]})}),l=e.jsx("div",{className:"govuk-grid-row",children:e.jsxs("div",{className:"govuk-grid-column-full",children:[e.jsx(K,{keyInfo:s.datasetMetadata.keyInfo}),e.jsx(Q,{notes:s.datasetMetadata.notes}),e.jsx(J,{about:s.datasetMetadata.about}),e.jsx(X,{published:s.datasetMetadata.published})]})}),u=e.jsx("div",{className:"govuk-grid-row",children:e.jsx("div",{className:"govuk-grid-column-full",children:e.jsxs("form",{method:"get",action:P(`/published/${s.dataset.id}/download`,n.language),children:[e.jsx(v,{name:"view_type",label:e.jsx(t,{children:"consumer_view.download_heading"}),options:[{value:"filtered",label:e.jsx(t,{children:"consumer_view.filtered_download"}),disabled:!0},{value:"default",label:e.jsx(t,{children:"consumer_view.default_download"})}],value:"default"}),e.jsx(v,{name:"format",label:e.jsx(t,{children:"consumer_view.download_format"}),options:[{value:"csv",label:"CSV",hint:e.jsx(t,{children:"consumer_view.data_only_hint"})},{value:"xlsx",label:"Excel",hint:e.jsx(t,{children:"consumer_view.data_metadata_hint"})},{value:"parquet",label:"Parquet",hint:e.jsx(t,{children:"consumer_view.data_metadata_hint"})},{value:"duckdb",label:"DuckDB",hint:e.jsx(t,{children:"consumer_view.everything_hint"})}]}),e.jsx(v,{name:"number_format",label:e.jsx(t,{children:"consumer_view.number_formating"}),options:[{value:"default",label:e.jsx(t,{children:"consumer_view.formatted_numbers"}),hint:e.jsx(t,{children:"consumer_view.formatted_numbers_hint"})},{value:"raw",label:e.jsx(t,{children:"consumer_view.unformatted_numbers"}),disabled:!0}],value:"default"}),e.jsx(v,{name:"download_language",label:e.jsx(t,{children:"consumer_view.select_language"}),options:[{value:"en-GB",label:e.jsx(t,{children:"consumer_view.english"})},{value:"cy-GB",label:e.jsx(t,{children:"consumer_view.welsh"})}]}),e.jsx("button",{name:"action",value:"download",type:"submit",className:"govuk-button button-blue","data-module":"govuk-button",children:e.jsx(t,{children:"consumer_view.download_button"})})]})})});return e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"govuk-heading-xl",children:s.datasetMetadata.title}),(s.preview||(s==null?void 0:s.isDeveloper)&&(s==null?void 0:s.ShowDeveloperTab))&&e.jsx(T,{...s}),s.preview&&e.jsx("div",{className:"govuk-panel",children:e.jsx("p",{className:"govuk-panel__title-m",children:e.jsx(t,{children:"publish.cube_preview.panel"})})}),e.jsxs("div",{className:"govuk-tabs","data-module":"govuk-tabs",children:[e.jsx("h2",{className:"govuk-tabs__title",children:e.jsx(t,{children:"toc"})}),e.jsx(D,{tabs:[{label:e.jsx(t,{children:"consumer_view.data"}),id:"data",children:r},{label:e.jsx(t,{children:"consumer_view.about_this_dataset"}),id:"about_dataset",children:l},{label:e.jsx(t,{children:"consumer_view.download"}),id:"download_dataset",children:u}]})]})]})});export{ge as default};
