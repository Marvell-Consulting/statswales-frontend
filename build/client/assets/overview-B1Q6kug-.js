import{w as m}from"./with-props-daUcymKh.js";import{j as e}from"./context-Zvpbq3dQ.js";import{L as d}from"./LocaleLink-CIhOCkNj.js";import{u as v,T as s}from"./T-CQIXqhPq.js";import{E as b}from"./ErrorHandler-Dy9h9pDk.js";import{F as x}from"./FlashMessages-Dg7CLHPF.js";import{E as j}from"./ErrorProvider-Cxuz4RMS.js";import{D as y}from"./DatasetStatus-BlR5j9Z6.js";import{T as g}from"./Tabs-BPtvNYv5.js";import{T as _}from"./Table-BHT1KmCI.js";import{d as p}from"./date-format-trgs2e0w.js";import"./chunk-DQRVZFIR-CI4QRDf9.js";import"./locale-url-yD_AyXRN.js";import"./clsx-B-dksMZM.js";import"./status-to-colour-CUWEJy7V.js";function u({path:l,action:i,newTab:a,queryParams:t}){return e.jsx(d,{className:"govuk-link govuk-link--no-underline",path:l,query:t,target:a?"_blank":void 0,children:e.jsxs(s,{children:["publish.overview.actions.",i]})})}function w({datasetId:l,canEdit:i,canApprove:a,canMoveGroup:t,datasetStatus:o,publishingStatus:r,openPublishTask:n}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"task-decision-buttons",children:[a&&["pending_approval","update_pending_approval"].includes(r)&&e.jsx(d,{path:`/publish/${l}/task-decision/${n==null?void 0:n.id}`,className:"govuk-button govuk-!-margin-top-4",children:e.jsx(s,{children:"publish.overview.buttons.pending_approval"})}),i&&(n==null?void 0:n.status)==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"govuk-body",children:e.jsx(s,{children:"publish.overview.rejected.summary"})}),e.jsx("p",{className:"govuk-body",children:n==null?void 0:n.comment}),e.jsx(d,{path:`/publish/${l}/tasklist`,className:"govuk-button govuk-!-margin-top-4",children:e.jsx(s,{children:"publish.overview.buttons.fix"})})]})]}),e.jsxs("ul",{className:"govuk-list",children:[i&&r==="incomplete"&&e.jsx("li",{children:e.jsx(u,{path:`/publish/${l}/tasklist`,action:"continue"})}),i&&r==="update_incomplete"&&e.jsx("li",{children:e.jsx(u,{path:`/publish/${l}/tasklist`,action:"continue_update"})}),o==="live"&&e.jsx("li",{children:e.jsx(u,{path:`/published/${l}`,action:"view_published_dataset",newTab:!0})}),i&&r==="published"&&e.jsx("li",{children:e.jsx(u,{path:`/publish/${l}/update`,action:"update_dataset"})}),r!=="published"&&e.jsx("li",{children:e.jsx(u,{path:`/publish/${l}/cube-preview`,action:"preview"})}),i&&["pending_approval","update_pending_approval","scheduled","update_scheduled"].includes(r)&&e.jsx("li",{children:e.jsx(u,{path:`/publish/${l}/overview`,action:["update_scheduled","update_pending_approval"].includes(r)?"withdraw_update_revision":"withdraw_first_revision",queryParams:{withdraw:"true"}})}),t&&e.jsx("li",{children:e.jsx(u,{path:"move",action:"move"})})]})]})}function f({history:l}){const{i18n:i}=v(),a=[{key:"created_at",label:e.jsx(s,{children:"publish.overview.history.table.created_at"}),format:(t,o)=>e.jsx("span",{"data-eventid":o.id,children:p(t,"h:mmaaa, d MMMM yyyy",{locale:i.language})})},{key:"action",label:e.jsx(s,{children:"publish.overview.history.table.action"}),format:(t,o)=>{if(o.entity==="dataset")return e.jsxs(s,{children:["publish.overview.history.event.dataset.",t]});if(o.entity==="revision")return e.jsxs(s,{children:["publish.overview.history.event.revision.",t]});if(o.entity==="task"){const{action:r,status:n,isUpdate:c}=o.data;if(r==="publish")return e.jsxs(s,{children:["publish.overview.history.event.task.publish.",c?`update_${n}`:n]})}}},{key:"created_by",label:e.jsx(s,{children:"publish.overview.history.table.user"}),format:t=>t==="system"?e.jsx(s,{children:"publish.overview.history.event.created_by.system"}):t},{key:"comment",label:e.jsx(s,{children:"publish.overview.history.table.comment"}),format:(t,o)=>{var r;if(o.entity==="task")return(r=o.data)==null?void 0:r.comment}}];return e.jsx(_,{columns:a,rows:l})}const U=m(function({loaderData:i}){var t,o,r,n,c,h;(t=i.dataset)==null||t.id;const{t:a}=v();return e.jsx(j,{errors:i.errors,children:e.jsx("div",{className:"govuk-grid-row",children:e.jsxs("div",{className:"govuk-grid-column-full",children:[e.jsx(x,{}),e.jsx("span",{className:"region-subhead",children:a("publish.overview.subheading")}),e.jsx("h1",{className:"govuk-heading-xl govuk-!-margin-bottom-2",children:i.title}),e.jsx(y,{publishingStatus:i.publishingStatus,datasetStatus:i.datasetStatus}),e.jsx(b,{}),e.jsxs("div",{className:"overview-details",children:[["pending_approval","update_pending_approval"].includes(i.publishingStatus)&&((o=i.revision)==null?void 0:o.publish_at)&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"govuk-body govuk-!-margin-0",children:e.jsx(s,{publishAt:p((r=i.revision)==null?void 0:r.publish_at,"h:mmaaa, d MMMM yyyy"),children:"publish.overview.pending.publish_at"})}),e.jsx("p",{className:"govuk-body govuk-!-margin-0",children:e.jsx(s,{userName:(n=i.openPublishTask)==null?void 0:n.created_by_name,children:"publish.overview.pending.requested_by"})})]}),["scheduled","update_scheduled"].includes(i.publishingStatus)&&((c=i.revision)==null?void 0:c.publish_at)&&e.jsx("p",{className:"govuk-body",children:e.jsx(s,{publishAt:p((h=i.revision)==null?void 0:h.publish_at,"h:mmaaa, d MMMM yyyy"),children:"publish.overview.scheduled.publish_at"})})]}),e.jsx(g,{tabs:[{id:"actions",label:e.jsx(s,{children:"publish.overview.tabs.actions"}),children:e.jsx(w,{datasetId:i.dataset.id,canEdit:i.canEdit,canApprove:i.canApprove,canMoveGroup:i.canMoveGroup,datasetStatus:i.datasetStatus,publishingStatus:i.publishingStatus,openPublishTask:i.openPublishTask})},{id:"history",label:e.jsx(s,{children:"publish.overview.tabs.history"}),children:e.jsx(f,{history:i.history})}]})]})})})});export{U as default};
